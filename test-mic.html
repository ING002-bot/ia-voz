<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Test Micr√≥fono Simple</title>
  <style>
    body {
      font-family: system-ui;
      background: #0f172a;
      color: #e2e8f0;
      padding: 40px;
      text-align: center;
    }
    h1 { color: #60a5fa; }
    .btn {
      background: #2563eb;
      color: white;
      border: none;
      padding: 20px 40px;
      border-radius: 12px;
      cursor: pointer;
      font-size: 24px;
      margin: 20px;
    }
    .btn:hover { background: #1d4ed8; }
    .btn.recording {
      background: #ef4444;
      animation: pulse 1s infinite;
    }
    @keyframes pulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.1); }
    }
    #result {
      margin-top: 30px;
      padding: 20px;
      background: #111827;
      border-radius: 12px;
      min-height: 100px;
      font-size: 18px;
    }
    .success { color: #10b981; }
    .error { color: #ef4444; }
  </style>
</head>
<body>
  <h1>üé§ Test de Micr√≥fono</h1>
  <p>Prueba simple para verificar que el micr√≥fono funcione</p>
  <p style="color: #f59e0b;">‚ö†Ô∏è Requiere conexi√≥n a internet</p>
  
  <button id="btn" class="btn">üé§ Haz clic y habla</button>
  
  <div id="result">Esperando...</div>

  <script>
    const btn = document.getElementById('btn');
    const result = document.getElementById('result');
    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
    
    if (!SpeechRecognition) {
      result.innerHTML = '<span class="error">‚ùå Tu navegador no soporta reconocimiento de voz.<br>Usa Chrome, Edge o Safari.</span>';
      btn.disabled = true;
      btn.style.opacity = '0.5';
    } else {
      const recognition = new SpeechRecognition();
      recognition.lang = 'es-ES';
      recognition.interimResults = false;
      
      let isRecording = false;
      
      recognition.onstart = () => {
        isRecording = true;
        btn.classList.add('recording');
        btn.textContent = '‚èπÔ∏è Habla ahora...';
        result.innerHTML = '<span class="success">‚úÖ Escuchando... Habla ahora!</span>';
        console.log('Escuchando...');
      };
      
      recognition.onend = () => {
        isRecording = false;
        btn.classList.remove('recording');
        btn.textContent = 'üé§ Haz clic y habla';
        console.log('Detenido');
      };
      
      recognition.onerror = (e) => {
        isRecording = false;
        btn.classList.remove('recording');
        btn.textContent = 'üé§ Haz clic y habla';
        
        let msg = '';
        switch(e.error) {
          case 'not-allowed':
            msg = '‚ùå Permisos denegados.<br><br>1. Haz clic en el icono de candado en la barra de direcciones<br>2. Permite el acceso al micr√≥fono<br>3. Recarga la p√°gina';
            break;
          case 'no-speech':
            msg = '‚ö†Ô∏è No escuch√© nada. Intenta de nuevo hablando m√°s cerca del micr√≥fono.';
            break;
          case 'audio-capture':
            msg = '‚ùå No se detect√≥ micr√≥fono. Verifica que est√© conectado.';
            break;
          case 'network':
            msg = '‚ùå Error de red.<br><br>El reconocimiento de voz de Chrome requiere <strong>conexi√≥n a internet</strong> para funcionar.<br><br>Verifica que est√©s conectado a internet e intenta de nuevo.';
            break;
          default:
            msg = `‚ùå Error: ${e.error}`;
        }
        
        result.innerHTML = `<span class="error">${msg}</span>`;
        console.error('Error:', e.error);
      };
      
      recognition.onresult = (e) => {
        const text = e.results[0][0].transcript;
        const confidence = (e.results[0][0].confidence * 100).toFixed(1);
        
        result.innerHTML = `
          <span class="success">‚úÖ ¬°Funcion√≥!</span><br><br>
          <strong>Dijiste:</strong> "${text}"<br>
          <strong>Confianza:</strong> ${confidence}%
        `;
        
        console.log('Reconocido:', text);
      };
      
      btn.addEventListener('click', () => {
        if (isRecording) {
          recognition.stop();
        } else {
          try {
            recognition.start();
          } catch (e) {
            console.error('Error al iniciar:', e);
            result.innerHTML = '<span class="error">‚ùå Error al iniciar. Recarga la p√°gina.</span>';
          }
        }
      });
    }
  </script>
</body>
</html>
